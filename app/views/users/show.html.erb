<%= render 'shared/header'%>
<%= render 'shared/second-header'%>

<body>
  <div class="user-show-container">
    <div class="user-profile">
      <div class="user-show-icon">
        <%= image_tag "human.jpg" %>
      </div>
      <div class="user-name">
        <h1><%= @user.nickname %></h1>
        <% if @user.id == current_user.id %> 
          <%= link_to 'プロフィールを編集', edit_user_path(@user), class: 'edit-profile-button' %>
        <% end %> 
      </div>
    </div>
    <div class="user-introduction">
      <%= @user.introduction %>
    </div>
    <% if (@user == @visitor) && (!current_user.permissions.exists?(room_id: @room.id)) %>
      <div class="room-permission-btns">
        <% @visitor.requests.each do |request| %>
          <% if request.room == @room %>
            <%= link_to '追加する', room_permissions_path(request.room_id, request_id: request.id), class: 'room-permission-btn', method: :post %> 
            <%# <%= link_to '拒否する', "#", class: 'room-destroy-btn', method: :delete %> 
          <% end %>
        <% end %>
      </div>
    <% elsif @room.present? && !@room.users.include?(@visitor) %>
      <div class="room-permission-message1"><%=@room.name%>への入室許可済みです！</div>
    <% elsif @room.users.include?(@visitor) %>
      <div class="room-permission-message2"><%=@room.name%>へ参加済みです！</div>
    <% end %>
    <hr>
    <div class="room-list-container">
      <% if @user.rooms.present?%>
        <% @user.rooms.each do |room|%>
          <ul class="room-list">
            <li class="room-item">
              <div class="room-info">
                <h3 class="room-name"><%=room.name%></h3>
                <div class="room-meta">
                  <span class="room-created"><%=l room.created_at%></span>
                  <span class="room-level">Level <%=room.level.name%></span>
                </div>
                <div class="room-habit">
                  <span>達成したい習慣: <%=room.habit%></span>
                </div>
                <div class="room-user">
                  <span>作成者: <%= room.creator.nickname %></span>
                </div>
              </div>
				      <div class="room-buttons">
                <%=link_to "詳細", room_path(room.id), class: "room-show-link" %>
              </div>
            </li>
          </ul>
        <% end %>
      <% else %>
        <span>まだルームはありません</span>
      <% end %>
    </div>
  </div>
</body>